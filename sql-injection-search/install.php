<?php
function hashPassword($password)
{
    // Mã hóa mật khẩu bằng phương thức password_hash
    $hashedPassword = password_hash($password, PASSWORD_DEFAULT);
    
    return $hashedPassword;
}
// Request khởi tạo database.
if (isset($_REQUEST["install.php"])) {
}
include("variable.php");
// Ket noi database
$link = new mysqli($db_server, $db_username, $db_password);

if ($link->connect_error) {
    die("Error fail: " . $link->connect_error);
}

$check_db_query = "SHOW DATABASES LIKE '$db_name'";
$check_db_result = $link->query($check_db_query);

if ($check_db_result->num_rows == 0) {
    // Cơ sở dữ liệu chưa tồn tại, hãy tạo mới
    $create_db_query = "CREATE DATABASE $db_name";
    $create_db_result = $link->query($create_db_query);

    if (!$create_db_result) {
        die("Error creating database: " . $link->error);
    }

    // Chon database
    mysqli_select_db($link, $db_name);

    /////////////////////////// KHỞI TẠO DỮ LIỆU DATABASE TỪ ĐÂY.///////////////////////////////////////

    // Tao bang product
    $sql = "CREATE TABLE IF NOT EXISTS product (
            id INT AUTO_INCREMENT NOT NULL,
            name_ VARCHAR(255),
            des_ VARCHAR(255),
            link_image VARCHAR(255),
            price INT,
            PRIMARY KEY (id)
        );";

    $recordset = $link->query($sql);

    if (!$recordset) {

        die("Error: " . $link->error);
    }

    // Tao bang user
    $sql = "CREATE TABLE useraccount (
        id INT AUTO_INCREMENT PRIMARY KEY,
        email VARCHAR(255) NOT NULL,
        password VARCHAR(255) NOT NULL,
        birthday VARCHAR(255)
    );";
    $recordset = $link->query($sql);
    if (!$recordset) {

        die("Error: " . $link->error);
    }

    //  Chèn dữ liệu bảng product
    $sql = "INSERT INTO product (name_, des_, link_image, price) VALUES
    ('Bút chì khắc tên sách', 'Mô tả 1', 'image1.jpg', 120000),
    ('Cây cam ngọt của tôi', 'Mô tả 2', 'image2.jpg', 78000),
    ('Nhà giả kim', 'Mô tả 3', 'image3.jpg', 124000),
    ('Quân vương', 'Mô tả 4', 'image4.jpg', 220000),
    ('Đêm trắng', 'Mô tả 5', 'image5.jpg', 100000),
    ('Thất lạc cõi người', 'Mô tả 6', 'image6.jpg', 130000),
    ('Ngôi nhà kỳ quái', 'Mô tả 7', 'image7.jpg', 140000),
    ('Suối cọp', 'Mô tả 8', 'image8.jpg', 190000);
    ";
    $recordset = $link->query($sql);
    if (!$recordset) {

        die("Error: " . $link->error);
    }

    $userData = array(
        array('userptit1@gmail.com', 'ptit1', '11/10/2001'),
        array('userptit2@gmail.com', 'ptit2', '16/04/2001'),
        array('userptit3@gmail.com', 'ptit3', '15/12/2001'),
        array('userptit4@example.com', 'ptit4', '17/09/2001'),
        array('userptit5@example.com', 'ptit5', '12/11/2001')
    );


    // Chuẩn bị câu lệnh SQL INSERT
    $sql = "INSERT INTO useraccount (email, password, birthday) VALUES ";

    // Lặp qua mảng dữ liệu người dùng và thêm vào câu lệnh SQL
    foreach ($userData as $user) {
        $sql .= "('" . $user[0] . "', '" . $user[1] . "', '" . $user[2] . "'),";
    }

    // Loại bỏ dấu phẩy cuối cùng
    $sql = rtrim($sql, ',');
    $recordset = $link->query($sql);
    if (!$recordset) {

        die("Error: " . $link->error);
    }
    
} else {
    // echo "Database đã tồn tại.";
}
